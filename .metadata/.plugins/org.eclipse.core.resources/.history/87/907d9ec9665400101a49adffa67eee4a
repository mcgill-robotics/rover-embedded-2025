/*
 * stspin948.h
 *
 *  Created on: Jun 28, 2025
 *      Author: vince
 */

#ifndef INC_STSPIN948_H_
#define INC_STSPIN948_H_

struct BrushedDriverConfig {
	uint8_t phase_a_port;
	uint8_t phase_a_pin;
	uint8_t phase_b_port;
	uint8_t phase_b_pin;
	uint8_t enFault_a_port;
	uint8_t enFault_a_pin;
	uint8_t enFault_b_port;
	uint8_t enFault_b_pin;
	TIM_HandleTypeDef* pwm_a_inst;
	uint8_t pwm_a_channel;
	TIM_HandleTypeDef* pwm_b_inst;
	uint8_t pwm_b_channel;
	DAC_HandleTypeDef* dacRef_a_inst;
	DAC_HandleTypeDef* dacRef_b_inst;
	uint8_t dacRef_a_channel;
	uint8_t dacRef_b_channel;
	ADC_HandleTypeDef* cur_a_inst;
	ADC_HandleTypeDef* cur_b_inst;
	uint8_t cur_a_channel;
	uint8_t cur_b_channel;

};

struct BrushedDriver {
	// outputs
	uint32_t pwm_a;
	uint32_t pwm_b;
	uint8_t phase_a;
	uint8_t phase_b;
	uin16_t dacRef_a;
	uint16_t dacRef_b;

	//inputs
	uint8_t enFault_a;
	uint8_t enFault_b;
	uint16_t cur_a;
	uint16_t cur_b;
	uint16_t raw_cur[2];

	//config
	struct BrushedDriverConfig* config;

};

void STSPIN948_ReadInputs(struct BrushedDriver* driverInstance);
void STSPIN948_SetOutputs(struct BrushedDriver* driverInstance);

#endif /* INC_STSPIN948_H_ */
